<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" type="image/svg+xml" 
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/icons/star.svg">
<title>OneYearLater</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
/* Body */
body { 
    font-family: "Roboto", sans-serif; 
    background: radial-gradient(circle at top, #0f2a25, #061a1f); 
    color: #e0fff9;  
    min-height:100vh; 
    margin:0; 
    overflow-x:hidden;
}

/* Container */
.container { 
    position: relative; 
    z-index: 1; 
    padding-top:60px; 
    max-width:700px; 
    margin:0 auto; 
    text-align:center; 
}

/* Countdown boxes */
.deadline { 
    display:flex; 
    justify-content:center; 
    gap:1rem; 
    margin-bottom:30px; 
    flex-wrap: wrap;
}
.deadline-format { 
    width:6rem; 
    height:6rem; 
    background: rgba(15,42,37,0.8); /* dark forest tint */
    color:#e0fff9; 
    display:grid; 
    place-items:center; 
    border-radius:12px; 
    box-shadow: 0 0 20px rgba(0,255,204,0.4); 
    transition: transform 0.3s, box-shadow 0.3s;
}
.deadline-format:hover {
    transform: scale(1.1);
    box-shadow: 0 0 35px rgba(0,255,204,0.6);
}
.deadline-format h2 { margin:0; font-size:1.5rem; }

/* Subtitle */
#subtitle { font-size:1.1rem; margin-bottom:20px; color:#a0fff5; }

/* Letter buttons */
#letter-buttons { margin-top:25px; }
#letter-buttons .btn { 
    background: #06332d; 
    border: 1px solid #00ffcc; 
    color:#e0fff9; 
    margin:0 10px;
    transition: all 0.3s;
}
#letter-buttons .btn:hover {
    background: #00ffcc; 
    color:#061a1f;
}

/* Sparkles */
#sparkles-container { 
    position:fixed; 
    top:0; 
    left:0; 
    width:100%; 
    height:100%; 
    pointer-events:none; 
    z-index:-1; 
    overflow:hidden; 
}

/* Modal */
.modal-content {
    background: #06332d; 
    color:#e0fff9;
    border: 1px solid #00ffcc;
    border-radius:12px;
}
.modal-header, .modal-footer { border:none; }
.modal-title { color:#e0fff9; }
.form-control {
    background: #0f2a25; 
    color:#e0fff9;
    border: 1px solid #00ffcc;
}
.modal-body { overflow-x: hidden; }
.modal-body p { word-wrap: break-word; white-space: pre-wrap; overflow-wrap: break-word; }
.form-control:focus {
    background: #0f2a25;
    color:#e0fff9;
    border-color: #00ffcc;
    box-shadow: 0 0 10px #00ffcc;
}
</style>
</head>
<body>
<!-- Passcode Overlay -->
<div id="passcodeOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; 
    background: radial-gradient(circle at center, #061a1f, #0f2a25);
    display:flex; flex-direction:column; justify-content:center; align-items:center; z-index:9999; 
    color:#7aa8a0; text-align:center; padding:20px;">
<h2 style="font-size:2rem; margin-bottom:20px; color:#7aa8a0;">‚ú® You Stand Before the Enchanted Forest ‚ú®</h2>
<p style="max-width:400px; font-size:1rem; line-height:1.5; margin-bottom:20px; color:#7aa8a0;">
    The ancient Time Fairies guard the secret portal that reaches to her. 
    Only those who know the magical words may enter and receive her message from the portal. 
    Take a deep breath‚Ä¶ step carefully‚Ä¶ and type the secret words below.
</p>
<input type="password" id="passcodeInput" placeholder="Enter the secret words..." 
        style="padding:10px; font-size:1rem; border:1px solid #7aa8a0; border-radius:8px; 
        background:#0f2a25; color:#e0fff9; margin-top:15px; width:200px; text-align:center;">
<button id="passcodeBtn" style="margin-top:15px; padding:8px 20px; border:none; border-radius:8px; 
    background:#00ffcc; color:#061a1f; font-weight:bold; cursor:pointer;">Step Into the Portal</button>
<p id="passcodeMessage" style="margin-top:15px; color:#ff6f91;"></p>
</div>

<!-- Main container -->
<div class="container" style="display:none;">
  <h2 id="title">‚ú® Your Future Awaits‚Ä¶ ‚ú®</h2>
  <div id="subtitle">Your personal portal awaits ‚ú®</div>
  <p style="color:#a0fff5; font-style:italic; margin-bottom:20px;">Promptly, a message will arrive</p>

  <div class="deadline">
    <div class="deadline-format"><h2 class="days">--</h2><span>days</span></div>
    <div class="deadline-format"><h2 class="hours">--</h2><span>hours</span></div>
    <div class="deadline-format"><h2 class="minutes">--</h2><span>mins</span></div>
    <div class="deadline-format"><h2 class="seconds">--</h2><span>secs</span></div>
  </div>

  <div id="letter-buttons" style="display:none;">
    <button id="readBtn" class="btn btn-primary">Read Letter</button>
    <button id="writeBtn" class="btn btn-primary">Write Letter</button>
  </div>
</div>

<!-- Read Modal -->
<div class="modal fade" id="readModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Her Message from the Forest ‚ú®</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body"><p id="letterContent"></p></div>
      <div class="modal-footer"><button class="btn btn-secondary" data-bs-dismiss="modal">Close</button></div>
    </div>
  </div>
</div>

<!-- Write Modal -->
<div class="modal fade" id="writeModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Write Your Letter</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>
      <div class="modal-body">
        <div style="background: rgba(0,255,204,0.1); color:#e0fff9; padding:10px; border-radius:8px; margin-bottom:15px; font-size:0.9rem; max-height:200px; overflow-y:auto;">
          <strong>Quest: Your One-Year Future Letter</strong><br>
          Write a letter from her (one year from today) and seal it until next year.<br><br>
          <strong>Objectives:</strong>
          <ul style="padding-left:18px; margin:5px 0;">
            <li>Set a calm, intentional environment.</li>
            <li>Write as her: accomplishments, emotional growth, surprises.</li>
            <li>List 3 ‚ÄúIf nothing else happens this year, I‚Äôm proud that I‚Ä¶‚Äù wins.</li>
            <li>Seal the letter (physical or digital) and set it aside until next year.</li>
          </ul>
          <strong>Tips:</strong>
          <ul style="padding-left:18px; margin:5px 0;">
            <li>Write in the ‚Äúafter‚Äù perspective, as if the year already happened.</li>
            <li>Optional ritual: tea, candle, playlist.</li>
            <li>Do not revisit until the same date next year.</li>
          </ul>
        </div>
        <textarea id="letterText" class="form-control" rows="8" placeholder="Write her letter here..."></textarea>
      </div>
      <div class="modal-footer">
        <button class="btn btn-primary" id="saveLetterBtn">Save Letter</button>
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>

<div id="sparkles-container"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
/* -----------------------------------------------------
   CONSTANTS & ELEMENTS
----------------------------------------------------- */
const correctPasscode = "magicforest";

const el = {
    overlay: document.getElementById("passcodeOverlay"),
    input: document.getElementById("passcodeInput"),
    btn: document.getElementById("passcodeBtn"),
    msg: document.getElementById("passcodeMessage"),
    container: document.querySelector(".container"),
    title: document.getElementById("title"),
    subtitle: document.getElementById("subtitle"),
    days: document.querySelector(".days"),
    hours: document.querySelector(".hours"),
    minutes: document.querySelector(".minutes"),
    seconds: document.querySelector(".seconds"),
    letterButtons: document.getElementById("letter-buttons"),
    sparkleContainer: document.getElementById("sparkles-container"),
    readModal: new bootstrap.Modal(document.getElementById("readModal")),
    writeModal: new bootstrap.Modal(document.getElementById("writeModal")),
    readBtn: document.getElementById("readBtn"),
    writeBtn: document.getElementById("writeBtn"),
    letterContent: document.getElementById("letterContent"),
    letterText: document.getElementById("letterText"),
    saveBtn: document.getElementById("saveLetterBtn")
};

// Dates
const READ_START = { month: 11, day: 1 };
const READ_END   = { month: 11, day: 10 };

/* -----------------------------------------------------
   UTILITIES
----------------------------------------------------- */
const pad = (n) => n.toString().padStart(2, "0");

function todayAt(m, d) {
    const now = new Date();
    return new Date(now.getFullYear(), m, d);
}

function isBetween(date, rangeStart, rangeEnd) {
    const d = new Date(date.getFullYear(), date.getMonth(), date.getDate());
    return d >= todayAt(rangeStart.month, rangeStart.day) &&
           d <= todayAt(rangeEnd.month, rangeEnd.day);
}

function nextDec1() {
    const now = new Date();
    let target = new Date(now.getFullYear(), 11, 1);
    if (now > target) target = new Date(now.getFullYear() + 1, 11, 1);
    return target;
}

/* -----------------------------------------------------
   PASSCODE SYSTEM
----------------------------------------------------- */
function unlockPortal() {
    el.overlay.style.display = "none";
    el.container.style.display = "block";
    updateCountdown();
}

function handlePasscodeSubmit() {
    if (el.input.value.toLowerCase() === correctPasscode) {
        el.msg.style.color = "#00ffcc";
        el.msg.textContent =
            "‚ú® The Time Fairies flutter around you, granting access to the portal‚Ä¶ she awaits! ‚ú®";

        sessionStorage.setItem("passcodeUnlocked", "true");

        setTimeout(unlockPortal, 1200);
    } else {
        el.msg.style.color = "#ff6f91";
        el.msg.textContent =
            "üö´ The Time Fairies block your path, whispering: 'Not yet‚Ä¶ try again.'";
        el.input.value = "";
        el.input.focus();
    }
}

el.btn.onclick = handlePasscodeSubmit;
el.input.addEventListener("keyup", (e) => {
    if (e.key === "Enter") handlePasscodeSubmit();
});

// Auto-unlock if session already opened
if (sessionStorage.getItem("passcodeUnlocked") === "true") {
    unlockPortal();
}

/* -----------------------------------------------------
   COUNTDOWN SYSTEM
----------------------------------------------------- */
let countdownInterval = null;

function startCountdownTimer() {
    if (countdownInterval) clearInterval(countdownInterval);
    countdownInterval = setInterval(updateCountdown, 1000);
}

function updateCountdown() {
    const now = new Date();

    // During reading period
    if (isBetween(now, READ_START, READ_END)) {
        el.title.textContent = "‚ú® The Portal Awaits ‚ú®";
        el.subtitle.innerHTML =
            "Step into the magical forest and reach through the portal‚Ä¶ there she awaits." +
            "<br><span style='display:block; text-align:center;'>Write or read her message and capture your dreams!</span>";
        el.letterButtons.style.display = "block";

        const end = new Date(now.getFullYear(), READ_END.month, READ_END.day, 23, 59, 59);
        const diff = end - now;

        const d = Math.floor(diff / 86400000);
        const h = Math.floor((diff / 3600000) % 24);
        const m = Math.floor((diff / 60000) % 60);
        const s = Math.floor((diff / 1000) % 60);

        el.days.textContent = pad(d);
        el.hours.textContent = pad(h);
        el.minutes.textContent = pad(m);
        el.seconds.textContent = pad(s);
        return;
    }

    // Countdown outside the reading window
    const target = nextDec1();
    const diff = target - now;

    const d = Math.floor(diff / 86400000);
    const h = Math.floor((diff / 3600000) % 24);
    const m = Math.floor((diff / 60000) % 60);
    const s = Math.floor((diff / 1000) % 60);

    el.days.textContent = pad(d);
    el.hours.textContent = pad(h);
    el.minutes.textContent = pad(m);
    el.seconds.textContent = pad(s);

    // Before November 1
    if (now < todayAt(READ_START.month, READ_START.day)) {
        el.title.textContent = "‚ú® Await the Portal‚Ä¶ ‚ú®";
        el.subtitle.textContent =
            "Her message stirs in the magical forest, waiting for you to reach through.";
        el.letterButtons.style.display = "none";

    // After November 10
    } else {
        el.title.textContent = "‚ú® The Portal Closes ‚ú®";
        el.subtitle.textContent =
            "Her message has returned safely through time. Return next year to glimpse the forest again.";
        el.letterButtons.style.display = "none";
    }
}

startCountdownTimer();
updateCountdown();

/* -----------------------------------------------------
   LETTER MODALS
----------------------------------------------------- */
el.readBtn.onclick = () => {
    el.letterContent.textContent =
        localStorage.getItem("futureLetter") || "No letter saved yet.";
    el.readModal.show();
};

el.writeBtn.onclick = () => {
    el.letterText.value = localStorage.getItem("futureLetter") || "";
    el.writeModal.show();
};

el.saveBtn.onclick = () => {
    localStorage.setItem("futureLetter", el.letterText.value.trim());
    el.writeModal.hide();
    alert("Her letter is safely sealed in the magical forest! ‚ú®");
};

/* -----------------------------------------------------
   SPARKLES
----------------------------------------------------- */
function createSparkle() {
    const s = document.createElement("div");
    const size = 4 + Math.random() * 6;

    Object.assign(s.style, {
        width: size + "px",
        height: size + "px",
        position: "absolute",
        top: "-10px",
        left: Math.random() * window.innerWidth + "px",
        borderRadius: "50%",
        filter: "blur(1px)",
        pointerEvents: "none",
        opacity: Math.random() * 0.8 + 0.3,
        background: `radial-gradient(circle, ${
            ["#00FFCC", "#FFD700", "#FF69B4"][Math.floor(Math.random() * 3)]
        }, transparent)`
    });

    el.sparkleContainer.appendChild(s);

    let y = -10;
    const speed = 1 + Math.random() * 2;

    const fall = () => {
        y += speed;
        s.style.top = y + "px";
        if (y < window.innerHeight + 10) requestAnimationFrame(fall);
        else s.remove();
    };
    fall();
}

setInterval(createSparkle, 150);

/* -----------------------------------------------------
   BFCache FIX
----------------------------------------------------- */
window.addEventListener("pageshow", (event) => {
    if (event.persisted) {
        startCountdownTimer();
        updateCountdown();

        if (sessionStorage.getItem("passcodeUnlocked") === "true") {
            el.overlay.style.display = "none";
            el.container.style.display = "block";
        }
    }
});
</script>

</body>
</html>
